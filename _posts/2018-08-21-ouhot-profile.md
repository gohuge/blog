---
layout: post
title: "【ouhot】性能说明"
date: 2018-08-21 16:11:57
category: ouhot
tags: [ouhot]
---

- 性能评估，其实和应用设计有关，这能简单说明各个节点配置下面的运行指标。

- 我们希望应用不完全占用服务器的CPU,400%-600%为最佳运行条件。
（这种情况下，无论你查问题，还是代码异常都有一定的伸展空间，避免宕机）

<div class="divider"></div>

#### 一、数据库性能说明

ets的操作时间是30微秒，dets则是0.4毫秒，在这个基础上需要考虑磁盘的IOPS支撑，
阿里云盘说明上是>2w+（2017年数据），但实际IOPS达到2w 就形成io阻塞了，如果要做
4w+ IOPS,就采用SSD，还想增加就需要多一个节点（一个8核机器4w加的IPOS处于安全饱和状态）
对于机器的配置，请看“配置说明”

#### 二、计算节点性能说明

Erlang比其他虚拟机的高级语言运行效率慢很多，我只能给一款我们运营游戏的计算承载，
预计80个场景，4W+ 的怪物数量，AI满跑的情况下 600% CPU占用，计算节点缓存使用较少
配置8G完全足够。

#### 三、日志节点性能说明

日志节点主要问题还是IOPS，与不同应用需求记录的日志量有关系，我自认为游戏项目日志量
也算比较高了，任何消耗操作和关键操作都会进行记录，在我们游戏跑来同时在线5W的情况下
两台日志节点足以（相互备份，相互容灾）。

#### 四、关于腾讯的服务器架构设计合理标准
##### 一、要有停服公告机制
在停服，用户要能知道原因，开服时间。
##### 二、系统繁忙(过载)时的友好提示
当游戏系统繁忙时，需在用户登录时给予友好的提示，或设计登录排队系统。
##### 三、在出现故障后，限制频繁登录，防止出现雪崩
对于登录超时或失败的情况，不要频繁拉取授权的页面的机制，应遵循以下机制：
1. 登录超时或失败连续三次以后，等待10秒钟才能重试尝试下一次；
2. 连续登录6次超时或失败以后，等待间隔调整为5分钟。
3. 间隔时间应该在客户端本地存储，即使用户重启客户端，也不能自动切回10秒等待时间或无等待时间。
当用户登录成功以后，才会改回无等待时间。
四、容灾处理
1. 不允许存在关键路径（游戏核心体验、玩法）上的单点（不可扩展的节点）；
2. 不允许因Cache中的数据变更未及时入库，导致可能发生10分钟以上的回档。
五、过载保护要求
1. 某个模块的过载要求不能引起其他模块的过载；
2. 若整个系统已经或即将过载，要求不能影响到现已在正常游戏的用户。
六、扩容
1. GameSvr建议支持运行时平行扩容，最低要求停机时能平行扩容。
2. 储存层如果是全区全服的架构，DB设计要支持分布和扩容，即允许通过配置修改DB路由，不可在GameSvr中写死DB数目和路由。可选择腾讯公司自研的云存储服务，如Tcaplus。
  如果使用开源的存储程序，则可使用sharding方法（见备注）。
  如果采用其他分布式路由，则需要明确说明路由算法和扩容方法。
3. 如果不使用公司内自研的云存储服务，则架构上要求加入Cache程序，且Cache也需要支持分布和扩容，可参考DB的方式。
4. Cache程序和DB程序都应该具备2小时内扩容100万PCU的能力。
