---
layout: post
title: Erlang文件读取速度和压缩率
date: 2018-10-23 13:47:57
description: 文件读取
img: software.jpg
category: blog
tags: [blog]
---
测试的目的在于，我认为文件写入磁盘中，最大的瓶颈在于吞吐量，要是能把数据先压缩，在写入文件中可能会提升很高的效率。

## 前言

主要应用场景是出于对数据库备份还原的思考，假设从节点，把数据收集起来压缩好，发给dump节点，那写入量和通信量都会降低。重要的是dump节点可以很快写入。

我准备了一个比较复杂的数据二进制文件，存放的是玩家的包裹。

数据量127w条，资源大小（278500342byte）265m ；

压缩方式: zlib:compress(Bin) ;
解压方式：zlib:uncompress(Bin) ;

**一次性读取文件至内存的时长为 475 ms**
```
..load_file..278500342,time= 475
```
**压缩时长为 11040 ms，压缩后大小为(75267974byte) 71m**
```
compress time = 11040 ,size = 75267974 
```
**解缩时长为 1194 ms，压缩后大小为(278500342byte) 475m**
```
uncompress time = 1194 ,size = 278500342 
```

消耗说明： 主要消耗是CPU 25% *8 
## 其他说明

- 本次操作，由于文件大小是可控大小，所以一次读完。
- 实际运用中会分块读取，多个进程同时读取多个文件，每次读取是有限制的。
- 比如数据表，每次读取6 * 1024 * 1024(6m)的数据量，多表同时进行。
