---
layout: post
title: "FireDog集群-节点和服务构建"
date: 2018-1-23 13:46:57
category: firedog
tags: [firedog]
---

firedog集群构建

<div class="divider"></div>

##### Cluster
集群由组要的几部分构成，节点交互，状态管理部分，服务管理部分。

实现内容在boot包中。


##### 节点交互
1. 由cluster读取配置文件，将配置中的节点信息数据映射至内存环境。
2. 通过配置节点信息，生成node对象，和slave对象；
3. node对象负责运行状态管理，node数据同步，服务管理偏向业务层用户；
4. node_server提供node的各种支持，会启动server，和对其他node进行ping检测；
5. 这里采用了tcp/ip协议，直接传输二进制数据，最大传输数据为4m。
6. 可以考虑udp，但从安全起见没有这样做。
7. node_server处理做状态检查，和部分信息同步，还会抛出重要的状态改变，比如nodedown、nodeup
8. 节点链接检测，2秒一次服务器识别是否真正断开的时间是2-5秒，因为状态检查每秒一次和2秒的oing检测可能会有错峰。

##### 节点服务
cluster 提供了服务信息的增、删、改、查，当然改动服务必须是本地节点操作。
集群的端口，会固定在一定范围，一台主机会在3000-4000的范围寻找可使用的端口，
所以最好的情况下，一台机器最多可以启动1000个子节点。

#### 服务
* 这里会认为服务都是go的协程，支持从A节点直接发送消息至B节点的服务进程中。
这里封装为family，名字可以后续修改为service。

* 我会把服务分为两类，即全局服务和本地服务，当然名字是他们的唯一特征。

* 底层最基础的服务变是缓存服务，它依然采用family实现。

* 服务的通信管道，后续可能会考虑信箱，当然现在是原生实现。
